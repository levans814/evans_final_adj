---
title: "R Notebook"
output: html_notebook
---

This is my notebook for my final project. I will be making a web application using shiny to show campaign finance information for the Missouri Senate race.

#Load packages
```{r}
library(shiny)
library(rsconnect)
library(tidyverse)
library(janitor)
```

#Load the data
```{r}
contributions <- read_csv("data/campfin/mo_contributions.csv")
candidates <- read_csv("data/campfin/candidates.csv")
committees <- read_csv("data/campfin/committees.csv")
```

#Documentation for these three tables: 

**Individual contributions**:
https://www.fec.gov/campaign-finance-data/contributions-individuals-file-description/
**Candidates**: 
https://www.fec.gov/campaign-finance-data/candidate-master-file-description/
**Committees**: 
https://www.fec.gov/campaign-finance-data/committee-master-file-description/

# DEAL WITH REFUNDS
Use function I found online to turn numeric data negative
```{r}
refunds <- contributions %>% filter(transaction_tp=="22Y") %>%
  mutate_if(is.numeric, funs(. * -1))
```
Make table without 22y so it doesn't get zeroed out but actually negated
```{r}
no_refunds <- contributions %>% filter(transaction_tp!="22Y")
```
Add in negative refunds
```{r}
clean_contribs<-no_refunds %>% add_row(refunds)
```

#narrow down to senate race and join candidates to clean_contribs
```{r}
party_contribs <- candidates %>% 
  filter(election_yr=="2022" & office_st=="MO" & office=="S") %>%
  inner_join(clean_contribs, by=c("pcc"="cmte_id")) %>%
  group_by(party) %>%
  summarise(total = sum(transaction_amt))
```

#totals for candidates, republican
```{r}
rep_cand_totals <- candidates %>% 
  filter(election_yr=="2022" & office_st=="MO" & office=="S") %>%
  inner_join(clean_contribs, by=c("pcc"="cmte_id")) %>%
  filter(party=="REP") %>% 
  group_by(cand_name) %>% 
  summarise(total=sum(transaction_amt)) %>% 
  arrange(desc(total))
```
#totals for cand, dems
```{r}
dem_cand_totals <- candidates %>% 
  filter(election_yr=="2022" & office_st=="MO" & office=="S") %>%
  inner_join(clean_contribs, by=c("pcc"="cmte_id")) %>%
  filter(party=="DEM") %>% 
  group_by(cand_name) %>% 
  summarise(total=sum(transaction_amt)) %>% 
  arrange(desc(total))
```
#totals for cands, unk
```{r}
unk_cand_totals <- candidates %>% 
  filter(election_yr=="2022" & office_st=="MO" & office=="S") %>%
  inner_join(clean_contribs, by=c("pcc"="cmte_id")) %>%
  filter(party=="UNK") %>% 
  group_by(cand_name) %>% 
  summarise(total=sum(transaction_amt)) %>% 
  arrange(desc(total))
```


#Run the shiny app template
```{r}
ui <- fluidPage(
  
  titlePanel("Missouri Senate Race"),
  
  sidebarLayout(
    sidebarPanel( selectInput("var", 
                  label = "Choose a variable to display",
                  choices = c("Republican", "Democrat",
                              "Unknown"),
                  selected = "Republican")
                  ),
    
    mainPanel(tableOutput("table"), tableOutput("TBL"))
  )
  
  
)

server <- function(input, output){
  
  output$TBL <- renderTable({
      party_contribs
  })
  
  output$table <- renderTable({data <- switch(input$var, 
                   "Republican" = rep_cand_totals,
                   "Democrat" = dem_cand_totals,
                   "Unknown" = unk_cand_totals)
  
})
}
shinyApp(ui=ui , server = server)

```

#Run example apps
```{r}
runExample("02_text")
```


#Note to Laura, tutorial timestamp 1:00:11 https://shiny.rstudio.com/tutorial/